<project name="DieDieDie" default="compile" basedir="..">
	<property file="ant/build.properties"/>

    <path id="build-classpath">
 	    <fileset dir="${lib.dir}"/>
    </path>

    <target name="clean">
        <echo>Cleaning the ${build.dir}</echo>
        <delete dir="${build.dir}"/>
    </target>

    <target name="init" depends="clean">
        <echo>Creating the build directory</echo>
        <mkdir dir="${build.dir}/org/diediedie"/>
        <mkdir dir="${build.dir}/lib"/>
    </target>

    <target name="compile" depends="init">
        <echo>Compile the source files</echo>
        <javac srcdir="${src.dir}" 
               destdir="${build.dir}" 
               debug="true"
               optimize="on">
            <classpath refid="build-classpath"/>
        </javac>

        <echo>Copy the third-party jars to build dir</echo>
        <copy todir="${build.dir}/lib">
            <fileset dir="${lib.dir}"/>
        </copy>

        <echo>Copy the game data</echo>
        <copy todir="${build.dir}/data">
            <fileset dir="${basedir}/data"/>
        </copy>

        <echo>Copy the run scripts</echo>
        <copy file="run-linux" todir="${build.dir}"/>
        <copy file="run-windows.bat" todir="${build.dir}"/>
    </target>
        
    <!-- This doesn't work! Use run-linux / run-windows instead -->
    <target name="run" depends="compile" >
    <java dir="${build.dir}" 
          fork="true" 
          classname="org.diediedie.DieDieDie" >
<!--
        <jvmarg value='-Djava.library.path="${build.dir}/lib"'/>
-->
        <jvmarg value='-Djava.library.path=lib/lwjgl.jar'/> 
        <classpath>            
            <pathelement location="${build.dir}"/>
            <pathelement location="${build.dir}/lib"/>
            <pathelement path="${build.dir}/lib/slick.jar"/>
            <pathelement path="${build.dir}/lib/slick-util.jar"/>
            <pathelement path="${build.dir}/lib/natives-linux.jar"/>
            <pathelement path="${build.dir}/lib/lwjgl.jar"/>
            <pathelement path="${build.dir}/lib/natives-win32.jar"/>
            <pathelement path="${build.dir}/lib/natives-mac.jar"/>
            <pathelement path="${build.dir}/lib/jinput.jar"/>
            <pathelement path="${build.dir}/lib/scalar.jar"/>
            <pathelement path="${build.dir}/lib/jorbis.jar"/>
            <pathelement path="${build.dir}/lib/jnlp.jar"/>
            <pathelement path="${build.dir}/lib/liblwjgl.jnilib"/>
            <pathelement path="${build.dir}/lib/liblwjgl-osx.jnilib"/>
            <pathelement path="${build.dir}/lib/openal.dylib"/>
            <pathelement path="${build.dir}/lib/packulike.jar"/>
            <pathelement path="${build.dir}/lib/lombox.jar"/>
            <pathelement path="${build.dir}/lib/ibxm.jar"/>
            <pathelement path="${build.dir}/lib/junit-4.4.jar"/>
            <pathelement path="${build.dir}/lib/hiero.jar"/>
            <pathelement path="${java.class.path}/"/>
        </classpath>
    </java>
    </target>
</project>
